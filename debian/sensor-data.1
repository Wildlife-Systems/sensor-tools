.TH SENSOR\-DATA 1 "January 2026" "sensor-tools" "User Commands"
.SH NAME
sensor\-data \- tools for managing and reading sensor data
.SH SYNOPSIS
.B sensor\-data
.I command
.RI [ options ]
.RI [ files .\|.\|.]
.SH DESCRIPTION
.B sensor\-data
provides command-line tools for working with sensor data files.
It can transform between JSON and CSV formats, detect and filter error readings,
and calculate statistics on numeric sensor data.
.PP
Input files can be JSON (.out format with one JSON array per line) or CSV.
If no input files are specified, data is read from stdin.
.SH COMMANDS
.TP
.B transform
Transform JSON or CSV sensor data files to JSON or CSV format.
Each sensor reading becomes a row in the output.
.TP
.B list\-rejects
List rejected readings (inverse of transform filters).
Outputs readings that would be filtered OUT by the specified filters.
Accepts the same options as transform.
.TP
.B count
Count sensor data readings that match the specified filters.
Outputs a single number representing the count of matching readings.
.TP
.B distinct
List unique values in a specified column.
Outputs each distinct value found, optionally with counts.
.TP
.B list\-errors
List error readings in sensor data files.
Detects DS18B20 sensors with temperature/value of 85 or \-127 (error conditions).
.TP
.B summarise\-errors
Summarise error readings in sensor data files with counts.
Groups errors by type and sensor.
.TP
.B stats
Calculate statistics for numeric sensor data.
Shows count, min, max, range, mean, and standard deviation.
Also shows quartiles (Q1, median, Q3, IQR), outlier detection (1.5*IQR method),
delta statistics for consecutive value changes, and volatility.
If timestamps are present, shows time range, duration, readings rate, 
typical sampling interval, and gap detection.
.TP
.B latest
Show the latest timestamp for each sensor_id.
Outputs sensor_id, unix_timestamp, and ISO date for each sensor's most recent reading.
.SH GLOBAL OPTIONS
.TP
.BR \-h ", " \-\-help
Show help message.
.TP
.BR \-V ", " \-\-version
Show version information.
.SH TRANSFORM OPTIONS
.TP
.BR \-o ", " \-\-output " " \fIfile\fR
Output file (default: stdout).
.TP
.BR \-if ", " \-\-input\-format " " \fIfmt\fR
Input format for stdin: json or csv (default: json).
.TP
.BR \-of ", " \-\-output\-format " " \fIfmt\fR
Output format: json or csv (default: json).
.TP
.BR \-r ", " \-\-recursive
Recursively process subdirectories.
.TP
.B \-v
Verbose output (show progress).
.TP
.B \-V
Very verbose output (show detailed progress).
.TP
.BR \-e ", " \-\-extension " " \fIext\fR
Filter files by extension (e.g., .out or out).
.TP
.BR \-d ", " \-\-depth " " \fIn\fR
Maximum recursion depth (0 = current dir only).
.TP
.B \-\-use\-prototype
Use sc\-prototype command to define columns.
.TP
.BI \-\-not\-empty " column"
Skip rows where column is empty (can be used multiple times).
.TP
.BI \-\-only\-value " col:val"
Only include rows where column has specific value (can be used multiple times).
.TP
.BI \-\-exclude\-value " col:val"
Exclude rows where column has specific value (can be used multiple times).
.TP
.BI \-\-allowed\-values " column" " values|file"
Only include rows where column value is in the allowed list. 
The second argument can be comma-separated values (e.g., ds18b20,dht22) 
or a file path with one value per line.
.TP
.B \-\-remove\-errors
Remove error readings (DS18B20 value=85 or \-127).
.TP
.B \-\-remove\-whitespace
Remove extra whitespace from output (compact format).
.TP
.B \-\-remove\-empty\-json
Remove empty JSON input lines (e.g., [{}], []).
.TP
.B \-\-clean
Shorthand for \-\-remove\-empty\-json \-\-not\-empty value \-\-remove\-errors.
.TP
.BI \-\-min\-date " date"
Filter readings after this date (Unix timestamp, ISO date, or DD/MM/YYYY).
.TP
.BI \-\-max\-date " date"
Filter readings before this date (Unix timestamp, ISO date, or DD/MM/YYYY).
.TP
.BI \-\-tail " n"
Only read the last n lines from each file (useful for quick checks on large files).
.TP
.BI \-\-tail\-column\-value " col:val" " n"
Return last n rows where the specified column equals value.
Reads file backwards for efficiency on large files.
Example: \-\-tail\-column\-value sensor:ds18b20 10 returns last 10 rows where sensor is "ds18b20".
.TP
.BI \-\-update\-value " match" " target"
Update target column when match column has the specified value.
Both arguments use the format column:value.
Example: \-\-update\-value sensor:ds18b20 unit:C sets unit to "C" when sensor is "ds18b20".
.TP
.BI \-\-update\-where\-empty " match" " target"
Same as \-\-update\-value, but only updates if the target column is empty or missing.
Useful for adding default values without overwriting existing data.
.SH COUNT OPTIONS
.TP
.BR \-if ", " \-\-input\-format " " \fIfmt\fR
Input format for stdin: json or csv (default: json).
.TP
.BR \-of ", " \-\-output\-format " " \fIfmt\fR
Output format: human (default), csv, or json. Only applies when using \-\-by\-column or \-\-by\-month.
.TP
.BR \-b ", " \-\-by\-column " " \fIcolumn\fR
Show counts per value in the specified column instead of total count.
.TP
.B \-\-by\-day
Show counts per day in YYYY-MM-DD format, sorted ascending by date.
.TP
.B \-\-by\-week
Show counts per week in YYYY-Www format (ISO week number), sorted ascending by date.
.TP
.B \-\-by\-month
Show counts per month in YYYY-MM format, sorted ascending by date.
.TP
.B \-\-by\-year
Show counts per year in YYYY format, sorted ascending by date.
.TP
.BR \-o ", " \-\-output " " \fIfile\fR
Output file (default: stdout).
.TP
.BR \-f ", " \-\-follow
Follow mode: continuously read input and update count (stdin or single file).
.TP
.BR \-r ", " \-\-recursive
Recursively process subdirectories.
.TP
.B \-v
Verbose output (show progress).
.TP
.B \-V
Very verbose output (show detailed progress).
.TP
.BR \-e ", " \-\-extension " " \fIext\fR
Filter files by extension (e.g., .out or out).
.TP
.BR \-d ", " \-\-depth " " \fIn\fR
Maximum recursion depth (0 = current dir only).
.TP
.BI \-\-not\-empty " column"
Skip rows where column is empty (can be used multiple times).
.TP
.BI \-\-not\-null " column"
Skip rows where column contains the literal string "null" (can be used multiple times).
.TP
.BI \-\-only\-value " col:val"
Only include rows where column has specific value (can be used multiple times).
.TP
.BI \-\-exclude\-value " col:val"
Exclude rows where column has specific value (can be used multiple times).
.TP
.BI \-\-allowed\-values " column" " values|file"
Only include rows where column value is in the allowed list. 
The second argument can be comma-separated values (e.g., ds18b20,dht22) 
or a file path with one value per line.
.TP
.B \-\-remove\-errors
Remove error readings (DS18B20 value=85 or \-127).
.TP
.B \-\-remove\-empty\-json
Remove empty JSON input lines (e.g., [{}], []).
.TP
.B \-\-clean
Shorthand for \-\-remove\-empty\-json \-\-not\-empty value \-\-remove\-errors \-\-not\-null value \-\-not\-null sensor_id.
.TP
.BI \-\-min\-date " date"
Filter readings after this date.
.TP
.BI \-\-max\-date " date"
Filter readings before this date.
.TP
.BI \-\-tail " n"
Only read the last n lines from each file (useful for quick checks on large files).
.TP
.BI \-\-tail\-column\-value " col:val" " n"
Return last n rows where the specified column equals value.
.SH DISTINCT OPTIONS
.TP
.I column
The column name to get distinct values from (required, first positional argument).
.TP
.BR \-c ", " \-\-counts
Include count for each unique value, sorted by frequency descending.
.TP
.BR \-of ", " \-\-output\-format " " \fIfmt\fR
Output format: plain (default), csv, or json.
.TP
.BR \-if ", " \-\-input\-format " " \fIfmt\fR
Input format for stdin: json or csv (default: json).
.TP
.BR \-r ", " \-\-recursive
Recursively process subdirectories.
.TP
.B \-v
Verbose output.
.TP
.BR \-e ", " \-\-extension " " \fIext\fR
Filter files by extension.
.TP
.BR \-d ", " \-\-depth " " \fIn\fR
Maximum recursion depth.
.TP
.BI \-\-only\-value " col:val"
Only include rows where column has specific value.
.TP
.BI \-\-exclude\-value " col:val"
Exclude rows where column has specific value.
.TP
.B \-\-clean
Shorthand for \-\-remove\-empty\-json \-\-not\-empty value \-\-remove\-errors.
.SH LIST\-ERRORS AND SUMMARISE\-ERRORS OPTIONS
.TP
.BR \-if ", " \-\-input\-format " " \fIfmt\fR
Input format for stdin: json or csv (default: json).
.TP
.BR \-r ", " \-\-recursive
Recursively process subdirectories.
.TP
.B \-v
Verbose output.
.TP
.B \-V
Very verbose output.
.TP
.BR \-e ", " \-\-extension " " \fIext\fR
Filter files by extension (e.g., .out or out).
.TP
.BR \-d ", " \-\-depth " " \fIn\fR
Maximum recursion depth (0 = current dir only).
.TP
.BI \-\-min\-date " date"
Filter readings after this date.
.TP
.BI \-\-max\-date " date"
Filter readings before this date.
.SH STATS OPTIONS
.TP
.BR \-c ", " \-\-column " " \fIname\fR
Analyze only this column (default: value).
.TP
.BR \-if ", " \-\-input\-format " " \fIfmt\fR
Input format for stdin: json or csv (default: json).
.TP
.BR \-f ", " \-\-follow
Follow mode: continuously read input and update stats (stdin or single file).
.TP
.BI \-\-only\-value " col:val"
Only include rows where column has specific value (can be used multiple times).
.TP
.BI \-\-exclude\-value " col:val"
Exclude rows where column has specific value (can be used multiple times).
.TP
.BI \-\-allowed\-values " column" " values|file"
Only include rows where column value is in the allowed list. 
The second argument can be comma-separated values (e.g., ds18b20,dht22) 
or a file path with one value per line.
.TP
.BI \-\-not\-empty " column"
Skip rows where column is empty (can be used multiple times).
.TP
.BI \-\-not\-null " column"
Skip rows where column contains the literal string "null" (can be used multiple times).
.TP
.B \-\-remove\-empty\-json
Remove empty JSON input lines (e.g., [{}], []).
.TP
.B \-\-remove\-errors
Remove error readings (DS18B20 value=85 or \-127).
.TP
.B \-\-clean
Shorthand for \-\-remove\-empty\-json \-\-not\-empty value \-\-remove\-errors \-\-not\-null value \-\-not\-null sensor_id.
.TP
.BR \-r ", " \-\-recursive
Recursively process subdirectories.
.TP
.B \-v
Verbose output.
.TP
.B \-V
Very verbose output.
.TP
.BR \-e ", " \-\-extension " " \fIext\fR
Filter files by extension (e.g., .out or out).
.TP
.BR \-d ", " \-\-depth " " \fIn\fR
Maximum recursion depth (0 = current dir only).
.TP
.BI \-\-min\-date " date"
Filter readings after this date.
.TP
.BI \-\-max\-date " date"
Filter readings before this date.
.TP
.BI \-\-tail " n"
Only read the last n lines from each file (useful for quick checks on large files).
.SH LATEST OPTIONS
.TP
.BI \-n " num"
Limit output rows (positive = first n sensors, negative = last n sensors).
.TP
.BR \-of ", " \-\-output\-format " " \fIfmt\fR
Output format: human (default), csv, or json.
.TP
.BR \-if ", " \-\-input\-format " " \fIfmt\fR
Input format for stdin: json or csv (default: json).
.TP
.BR \-r ", " \-\-recursive
Recursively process subdirectories.
.TP
.B \-v
Verbose output.
.TP
.BR \-e ", " \-\-extension " " \fIext\fR
Filter files by extension (e.g., .out or out).
.TP
.BR \-d ", " \-\-depth " " \fIn\fR
Maximum recursion depth (0 = current dir only).
.TP
.BI \-\-min\-date " date"
Filter readings after this date.
.TP
.BI \-\-max\-date " date"
Filter readings before this date.
.TP
.BI \-\-tail " n"
Only read the last n lines from each file (useful for quick checks on large files).
.SH EXAMPLES
Transform a JSON sensor file to CSV:
.PP
.RS
sensor\-data transform \-of csv sensor1.out
.RE
.PP
Transform multiple files with error filtering:
.PP
.RS
sensor\-data transform \-\-remove\-errors \-o output.csv sensor1.out sensor2.out
.RE
.PP
Transform all .out files in a directory recursively:
.PP
.RS
sensor\-data transform \-r \-e .out \-o output.csv /path/to/logs/
.RE
.PP
Read from stdin and filter by sensor type:
.PP
.RS
cat sensor1.out | sensor\-data transform \-\-only\-value sensor:ds18b20
.RE
.PP
List error readings in sensor files:
.PP
.RS
sensor\-data list\-errors \-r \-e .out /path/to/logs/
.RE
.PP
Get statistics for a specific column:
.PP
.RS
sensor\-data stats \-c temperature sensor1.out
.RE
.PP
Filter by date range:
.PP
.RS
sensor\-data transform \-\-min\-date 2024\-01\-01 \-\-max\-date 2024\-12\-31 sensor.out
.RE
.PP
Count readings in a file:
.PP
.RS
sensor\-data count sensor1.out
.RE
.PP
Count readings excluding errors:
.PP
.RS
sensor\-data count \-\-remove\-errors \-r \-e .out /path/to/logs/
.RE
.PP
Get clean statistics (exclude empty values and errors):
.PP
.RS
sensor\-data stats \-\-clean sensor1.out
.RE
.PP
List distinct sensor names:
.PP
.RS
sensor\-data distinct sensor sensor1.out
.RE
.PP
List distinct sensor IDs with counts:
.PP
.RS
sensor\-data distinct sensor_id \-c \-r \-e out /path/to/logs/
.RE
.PP
Count readings per month:
.PP
.RS
sensor\-data count \-\-by\-month \-r \-e out /path/to/logs/
.RE
.SH EXIT STATUS
.TP
.B 0
Successful execution.
.TP
.B 1
An error occurred.
.SH FILES
.TP
.I *.out
JSON sensor data files (one JSON array per line).
.TP
.I *.csv
CSV sensor data files.
.SH AUTHOR
Ed Baker <ed@ebaker.me.uk>
.SH REPORTING BUGS
Report bugs at: https://github.com/edwbaker/sensors\-tools/issues
.SH COPYRIGHT
Copyright \(co 2026 Ed Baker.
License GPLv2+: GNU GPL version 2 or later.
.br
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
.SH SEE ALSO
.BR sc\-prototype (1)
